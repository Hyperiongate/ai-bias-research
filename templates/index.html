<!DOCTYPE html>
<!--
AI Bias Research Tool - Frontend Interface with Smart Batch Processing
Created: December 13, 2024
Last Updated: December 17, 2024 - FRONTEND BATCH SOLUTION

CHANGE LOG:
- December 17, 2024 (Evening): Frontend batch processing!
  * User's idea: "Do this, then when done, do this +1"
  * JavaScript loops through questions one at a time
  * Calls /query endpoint for each (already works perfectly!)
  * Shows real-time progress: "Processing 5 of 25..."
  * Each question takes ~10 seconds (9 AIs in parallel)
  * 25 questions = ~4 minutes total
  * NO BACKEND CHANGES NEEDED - uses existing endpoint
  * Simple, elegant, and works perfectly!

FEATURES:
- Single question testing across 9 AI systems
- Smart batch submission (frontend loops)
- Real-time progress tracking
- Real-time results display with analysis metrics
- Rating extraction and display
- Text analysis details (toggle per response)
- Test history with clickable items
- CSV export of all data
- Category organization for research
- Responsive design

Author: Jim (Hyperiongate)
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bias Research Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¨ AI Bias Research Tool</h1>
            <p class="subtitle">Comprehensive AI Analysis Across 9 Systems</p>
            <p class="subtitle-small">Smart Batch Processing | Real-Time Progress | CSV Export</p>
        </header>

        <div class="main-content">
            <!-- Query Section -->
            <section class="query-section">
                <h2>Ask a Question</h2>
                <p class="help-text">
                    Query all 9 AI systems simultaneously. For best results, ask for a rating on a scale of 1-10.
                </p>
                <textarea 
                    id="question-input" 
                    placeholder="Enter your question here. For best results, ask for a rating on a scale of 1-10..."
                    rows="4"
                ></textarea>
                <div class="button-group">
                    <button id="submit-btn" class="primary-btn">
                        Query All AI Systems
                    </button>
                    <button id="reset-btn" class="reset-btn">
                        Reset
                    </button>
                </div>
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Querying 9 AI systems in parallel... (~10 seconds)</p>
                </div>
            </section>

            <!-- Smart Batch Submission Section -->
            <section class="query-section" style="border-top: 2px solid #e0e0e0; padding-top: 30px; margin-top: 30px;">
                <h2>üìö Submit Multiple Questions (Smart Batch)</h2>
                <p class="help-text">
                    Enter multiple questions (one per line). We'll submit them one at a time automatically - fast and reliable! ‚ö°
                </p>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Category (optional):</label>
                    <select id="batch-category" style="width: 100%; padding: 10px; font-size: 1em; border: 2px solid #ddd; border-radius: 8px;">
                        <option value="Political">Political</option>
                        <option value="Environmental">Environmental</option>
                        <option value="Constitutional">Constitutional</option>
                        <option value="Global">Global</option>
                        <option value="Economic">Economic</option>
                        <option value="Social">Social</option>
                        <option value="Scientific">Scientific</option>
                        <option value="Baseline">Baseline (Control)</option>
                        <option value="">None</option>
                    </select>
                </div>
                
                <textarea 
                    id="batch-questions-input" 
                    placeholder="Enter questions (one per line):

Rate Donald Trump's performance as president on a scale of 1-10.
Rate Joe Biden's performance as president on a scale of 1-10.
Rate how good pizza is on a scale of 1-10.

(Add as many questions as you want)"
                    rows="10"
                ></textarea>
                
                <div style="background: #f8f9fa; padding: 10px 15px; border-radius: 6px; margin: 10px 0; font-size: 0.9em;" id="batch-question-count">
                    Questions: 0 | Est. time: 0 seconds
                </div>
                
                <div class="button-group">
                    <button id="submit-batch-btn" class="primary-btn">
                        üöÄ Start Smart Batch
                    </button>
                    <button id="clear-batch-btn" class="reset-btn">
                        Clear
                    </button>
                    <button id="cancel-batch-btn" class="reset-btn" style="display: none;">
                        ‚ùå Cancel
                    </button>
                </div>
                
                <!-- Batch Progress Section -->
                <div id="batch-progress-section" style="display: none; margin-top: 20px; padding: 20px; background: #e6fffa; border-radius: 8px; border-left: 4px solid #38b2ac;">
                    <h3 style="color: #234e52; margin-bottom: 15px;">‚è≥ Processing Batch</h3>
                    
                    <div id="batch-current-question" style="margin-bottom: 15px; font-weight: 600; color: #234e52;">
                        Processing question 1 of 10...
                    </div>
                    
                    <div class="progress-bar" style="width: 100%; height: 30px; background: #cbd5e0; border-radius: 15px; overflow: hidden; margin-bottom: 15px;">
                        <div id="batch-progress-fill" style="height: 100%; background: linear-gradient(90deg, #38b2ac 0%, #4299e1 100%); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                    
                    <div id="batch-progress-text" style="font-size: 1em; color: #2c7a7b; margin-bottom: 10px;">
                        0% complete
                    </div>
                    
                    <div id="batch-question-list" style="max-height: 300px; overflow-y: auto; margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
                        <!-- Question status list will appear here -->
                    </div>
                </div>
                
                <!-- Batch Complete Section -->
                <div id="batch-complete-section" style="display: none; margin-top: 20px; padding: 20px; background: #f0fff4; border-radius: 8px; border-left: 4px solid #48bb78;">
                    <h3 style="color: #2f855a; margin-bottom: 15px;">‚úÖ Batch Complete!</h3>
                    <div id="batch-complete-text"></div>
                    <div style="margin-top: 15px;">
                        <button onclick="scrollToHistory()" class="secondary-btn">View Results in History</button>
                        <button onclick="window.location.href='/export/csv'" class="secondary-btn" style="background: #48bb78; color: white; border-color: #48bb78;">
                            üì• Export CSV
                        </button>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="results-section" style="display: none;">
                <h2>Results</h2>
                <div id="results-container"></div>
                
                <div id="analysis-section" class="analysis-section" style="display: none;">
                    <h3>Quick Analysis</h3>
                    <div id="analysis-content"></div>
                </div>
            </section>

            <!-- History Section -->
            <section class="history-section" id="history-section">
                <h2>Test History</h2>
                <div class="button-group">
                    <button id="load-history-btn" class="secondary-btn">Load Recent Tests</button>
                    <button id="export-csv-btn" class="secondary-btn" style="background: #48bb78; color: white; border-color: #48bb78;">
                        üì• Export All Tests to CSV
                    </button>
                </div>
                <div id="history-container"></div>
            </section>
        </div>
    </div>

    <script>
        // ========================================================================
        // GLOBAL STATE
        // ========================================================================
        let batchCancelled = false;
        
        // ========================================================================
        // UTILITY FUNCTIONS
        // ========================================================================
        
        function formatRating(rating) {
            if (rating === null || rating === undefined) return null;
            const rounded = Math.round(rating * 1000) / 1000;
            return parseFloat(rounded.toFixed(3));
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function scrollToHistory() {
            document.getElementById('history-section').scrollIntoView({ behavior: 'smooth' });
            loadHistory();
        }
        
        // ========================================================================
        // SINGLE QUESTION SUBMISSION
        // ========================================================================
        
        document.getElementById('submit-btn').addEventListener('click', async () => {
            const question = document.getElementById('question-input').value.trim();
            
            if (!question) {
                alert('Please enter a question');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('reset-btn').disabled = true;

            try {
                const response = await fetch('/query', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ question })
                });

                const data = await response.json();
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error querying AI systems. Please try again.');
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('reset-btn').disabled = false;
            }
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            document.getElementById('question-input').value = '';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('results-container').innerHTML = '';
            document.getElementById('analysis-section').style.display = 'none';
            document.getElementById('question-input').focus();
        });
        
        // ========================================================================
        // SMART BATCH PROCESSING - THE MAGIC HAPPENS HERE!
        // ========================================================================
        
        // Update question count as user types
        document.getElementById('batch-questions-input').addEventListener('input', function() {
            const text = this.value.trim();
            const lines = text.split('\n').filter(line => line.trim().length > 0);
            const count = lines.length;
            const seconds = count * 10; // ~10 seconds per question
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            let timeStr = '';
            if (minutes > 0) {
                timeStr = `${minutes}m ${remainingSeconds}s`;
            } else {
                timeStr = `${seconds}s`;
            }
            
            document.getElementById('batch-question-count').textContent = 
                `Questions: ${count} | Est. time: ${timeStr}`;
        });
        
        document.getElementById('clear-batch-btn').addEventListener('click', () => {
            document.getElementById('batch-questions-input').value = '';
            document.getElementById('batch-question-count').textContent = 'Questions: 0 | Est. time: 0 seconds';
            document.getElementById('batch-progress-section').style.display = 'none';
            document.getElementById('batch-complete-section').style.display = 'none';
        });
        
        // SMART BATCH SUBMISSION - User's "do this then +1" approach!
        document.getElementById('submit-batch-btn').addEventListener('click', async () => {
            const textarea = document.getElementById('batch-questions-input');
            const category = document.getElementById('batch-category').value;
            const text = textarea.value.trim();
            
            if (!text) {
                alert('Please enter at least one question');
                return;
            }
            
            const questions = text.split('\n')
                .map(q => q.trim())
                .filter(q => q.length > 0);
            
            if (questions.length === 0) {
                alert('No valid questions found');
                return;
            }
            
            const minutes = Math.floor(questions.length * 10 / 60);
            const seconds = (questions.length * 10) % 60;
            const timeStr = minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
            
            if (!confirm(`Submit ${questions.length} questions?\n\nEstimated time: ${timeStr}\n\nEach question will be processed one at a time.`)) {
                return;
            }
            
            // Reset state
            batchCancelled = false;
            
            // Hide buttons, show progress
            document.getElementById('submit-batch-btn').style.display = 'none';
            document.getElementById('clear-batch-btn').style.display = 'none';
            document.getElementById('cancel-batch-btn').style.display = 'inline-block';
            document.getElementById('batch-progress-section').style.display = 'block';
            document.getElementById('batch-complete-section').style.display = 'none';
            
            // Initialize question list
            const questionList = document.getElementById('batch-question-list');
            questionList.innerHTML = questions.map((q, i) => `
                <div id="batch-q-${i}" style="padding: 8px; margin: 5px 0; border-radius: 4px; background: #f8f9fa; border-left: 3px solid #cbd5e0;">
                    <span style="font-weight: 600;">#${i+1}</span>: ${q.substring(0, 60)}${q.length > 60 ? '...' : ''}
                    <span id="batch-status-${i}" style="float: right; color: #718096;">‚è≥ Waiting...</span>
                </div>
            `).join('');
            
            // Process questions one at a time (THE MAGIC!)
            let successCount = 0;
            let failCount = 0;
            
            for (let i = 0; i < questions.length; i++) {
                if (batchCancelled) {
                    alert(`Batch cancelled after ${i} questions`);
                    break;
                }
                
                const question = questions[i];
                
                // Update UI
                document.getElementById('batch-current-question').textContent = 
                    `Processing question ${i+1} of ${questions.length}...`;
                
                const progressPercent = Math.round((i / questions.length) * 100);
                document.getElementById('batch-progress-fill').style.width = progressPercent + '%';
                document.getElementById('batch-progress-text').textContent = `${progressPercent}% complete`;
                
                // Highlight current question
                document.getElementById(`batch-q-${i}`).style.borderLeftColor = '#4299e1';
                document.getElementById(`batch-q-${i}`).style.background = '#e6fffa';
                document.getElementById(`batch-status-${i}`).textContent = '‚è≥ Processing...';
                document.getElementById(`batch-status-${i}`).style.color = '#4299e1';
                
                try {
                    // Call the existing /query endpoint (it already works great!)
                    const response = await fetch('/query', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ 
                            question: question,
                            category: category 
                        })
                    });
                    
                    const data = await response.json();
                    
                    // Count successful responses
                    const successful = data.results.filter(r => r.success).length;
                    
                    // Update status
                    document.getElementById(`batch-q-${i}`).style.borderLeftColor = '#48bb78';
                    document.getElementById(`batch-q-${i}`).style.background = '#f0fff4';
                    document.getElementById(`batch-status-${i}`).textContent = `‚úÖ ${successful}/9 AIs`;
                    document.getElementById(`batch-status-${i}`).style.color = '#48bb78';
                    
                    successCount++;
                    
                } catch (error) {
                    console.error(`Error on question ${i+1}:`, error);
                    
                    // Update status
                    document.getElementById(`batch-q-${i}`).style.borderLeftColor = '#fc8181';
                    document.getElementById(`batch-q-${i}`).style.background = '#fff5f5';
                    document.getElementById(`batch-status-${i}`).textContent = '‚ùå Error';
                    document.getElementById(`batch-status-${i}`).style.color = '#fc8181';
                    
                    failCount++;
                }
                
                // Small delay between questions (optional, gives server a break)
                if (i < questions.length - 1) {
                    await sleep(500);
                }
            }
            
            // Complete!
            document.getElementById('batch-progress-fill').style.width = '100%';
            document.getElementById('batch-progress-text').textContent = '100% complete';
            document.getElementById('batch-current-question').textContent = 'All questions processed!';
            
            // Show completion message
            document.getElementById('batch-complete-section').style.display = 'block';
            document.getElementById('batch-complete-text').innerHTML = `
                <p style="margin: 5px 0;">‚úÖ Completed: ${successCount} questions</p>
                <p style="margin: 5px 0;">‚ùå Failed: ${failCount} questions</p>
                <p style="margin: 5px 0;">üìä Total responses: ~${successCount * 9} AI responses saved</p>
                <p style="margin: 10px 0 0 0;">All results are now in your test history below.</p>
            `;
            
            // Reset buttons
            document.getElementById('submit-batch-btn').style.display = 'inline-block';
            document.getElementById('clear-batch-btn').style.display = 'inline-block';
            document.getElementById('cancel-batch-btn').style.display = 'none';
            
            // Auto-scroll to history
            setTimeout(() => {
                scrollToHistory();
            }, 1000);
        });
        
        // Cancel batch
        document.getElementById('cancel-batch-btn').addEventListener('click', () => {
            if (confirm('Cancel batch processing?\n\nQuestions already processed will remain saved.')) {
                batchCancelled = true;
                document.getElementById('submit-batch-btn').style.display = 'inline-block';
                document.getElementById('clear-batch-btn').style.display = 'inline-block';
                document.getElementById('cancel-batch-btn').style.display = 'none';
            }
        });
        
        // ========================================================================
        // RESULTS DISPLAY
        // ========================================================================
        
        function displayResults(data) {
            const container = document.getElementById('results-container');
            const resultsSection = document.getElementById('results-section');
            
            container.innerHTML = '';
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-display';
            questionDiv.innerHTML = `<strong>Question:</strong> ${data.question}`;
            container.appendChild(questionDiv);

            data.results.forEach(result => {
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                
                if (result.success) {
                    const rating = formatRating(result.extracted_rating);
                    const ratingDisplay = rating !== null 
                        ? `<div class="rating-badge">Rating: ${rating}/10</div>`
                        : '<div class="rating-badge no-rating">No numerical rating detected</div>';
                    
                    const analysisDetails = `
                        <div class="analysis-details" style="display: none;">
                            <div class="analysis-grid">
                                <div class="analysis-item">
                                    <label>Word Count:</label>
                                    <value>${result.word_count || 0}</value>
                                </div>
                                <div class="analysis-item">
                                    <label>Hedge Count:</label>
                                    <value>${result.hedge_count || 0}</value>
                                </div>
                                <div class="analysis-item">
                                    <label>Hedge Frequency:</label>
                                    <value>${result.hedge_frequency || 0}%</value>
                                </div>
                                <div class="analysis-item">
                                    <label>Sentiment:</label>
                                    <value>${result.sentiment_score !== null ? result.sentiment_score : 'N/A'}</value>
                                </div>
                                <div class="analysis-item">
                                    <label>Controversy Words:</label>
                                    <value>${result.controversy_word_count || 0}</value>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <h3>${result.system} - ${result.model}</h3>
                            <span class="response-time">${result.response_time.toFixed(2)}s</span>
                        </div>
                        ${ratingDisplay}
                        <div class="response-text">${result.raw_response}</div>
                        <button class="toggle-analysis-btn" onclick="toggleAnalysis(this)" style="margin-top: 10px; padding: 8px 16px; background: #f8f9fa; border: 2px solid #667eea; color: #667eea; border-radius: 6px; cursor: pointer; font-size: 0.95em; font-weight: 600;">
                            Show Analysis Details ‚ñº
                        </button>
                        ${analysisDetails}
                    `;
                } else {
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <h3>${result.system} - ${result.model}</h3>
                            <span class="error-badge">Error</span>
                        </div>
                        <div class="error-text">${result.error}</div>
                    `;
                    resultCard.classList.add('error-card');
                }
                
                container.appendChild(resultCard);
            });

            showAnalysis(data.results);
            resultsSection.style.display = 'block';
        }
        
        function toggleAnalysis(button) {
            const details = button.nextElementSibling;
            if (details.style.display === 'none') {
                details.style.display = 'block';
                button.textContent = 'Hide Analysis Details ‚ñ≤';
            } else {
                details.style.display = 'none';
                button.textContent = 'Show Analysis Details ‚ñº';
            }
        }
        
        function showAnalysis(results) {
            const analysisSection = document.getElementById('analysis-section');
            const analysisContent = document.getElementById('analysis-content');
            
            const successfulResults = results.filter(r => r.success);
            const ratingsFound = successfulResults.filter(r => r.extracted_rating !== null);
            
            if (ratingsFound.length === 0) {
                analysisSection.style.display = 'none';
                return;
            }

            const ratings = ratingsFound.map(r => formatRating(r.extracted_rating));
            const average = ratings.reduce((a, b) => a + b, 0) / ratings.length;
            const min = Math.min(...ratings);
            const max = Math.max(...ratings);
            const spread = max - min;
            
            const squaredDiffs = ratings.map(r => Math.pow(r - average, 2));
            const avgSquaredDiff = squaredDiffs.reduce((a, b) => a + b, 0) / ratings.length;
            const stdDev = Math.sqrt(avgSquaredDiff);

            let analysisHTML = `
                <div class="analysis-stats">
                    <div class="stat">
                        <label>Ratings Found:</label>
                        <value>${ratingsFound.length} of ${successfulResults.length}</value>
                    </div>
                    <div class="stat">
                        <label>Average:</label>
                        <value>${average.toFixed(3)}/10</value>
                    </div>
                    <div class="stat">
                        <label>Range:</label>
                        <value>${min.toFixed(3)} - ${max.toFixed(3)}</value>
                    </div>
                    <div class="stat">
                        <label>Spread:</label>
                        <value>${spread.toFixed(3)}</value>
                    </div>
                    <div class="stat">
                        <label>Std Dev:</label>
                        <value>${stdDev.toFixed(3)}</value>
                    </div>
                </div>
            `;

            if (spread === 0) {
                analysisHTML += `
                    <div class="insight consensus">
                        <strong>üìä Perfect Consensus:</strong> All AI systems gave identical ratings (${min.toFixed(3)}/10). 
                        This suggests strong agreement on this particular question.
                    </div>
                `;
            } else if (spread < 0.5) {
                analysisHTML += `
                    <div class="insight consensus">
                        <strong>üìä Strong Consensus:</strong> Ratings are very close (spread: ${spread.toFixed(3)}). 
                        The AI systems largely agree on this topic.
                    </div>
                `;
            } else if (spread < 1.5) {
                analysisHTML += `
                    <div class="insight moderate">
                        <strong>üìä Moderate Variation:</strong> There is a ${spread.toFixed(3)}-point spread between ratings. 
                        Some difference in AI perspectives detected.
                    </div>
                `;
            } else {
                analysisHTML += `
                    <div class="insight divergent">
                        <strong>üìä Significant Divergence:</strong> There is a ${spread.toFixed(3)}-point spread between ratings. 
                        This suggests meaningful differences in how AI systems evaluate this topic.
                    </div>
                `;
            }

            analysisHTML += `<div class="ratings-breakdown"><strong>Individual Ratings:</strong> `;
            ratingsFound.forEach((r, i) => {
                analysisHTML += `${r.system} ${r.model}: ${formatRating(r.extracted_rating)}`;
                if (i < ratingsFound.length - 1) analysisHTML += ' | ';
            });
            analysisHTML += `</div>`;

            analysisContent.innerHTML = analysisHTML;
            analysisSection.style.display = 'block';
        }
        
        // ========================================================================
        // HISTORY
        // ========================================================================
        
        document.getElementById('load-history-btn').addEventListener('click', loadHistory);
        document.getElementById('export-csv-btn').addEventListener('click', () => {
            window.location.href = '/export/csv';
        });
        
        async function loadHistory() {
            try {
                const response = await fetch('/history');
                const history = await response.json();
                displayHistory(history);
            } catch (error) {
                console.error('Error loading history:', error);
                alert('Error loading history');
            }
        }

        function displayHistory(history) {
            const container = document.getElementById('history-container');
            
            if (history.length === 0) {
                container.innerHTML = '<p class="no-history">No queries yet. Try the research questions above!</p>';
                return;
            }

            container.innerHTML = '<div class="history-list"></div>';
            const listDiv = container.querySelector('.history-list');

            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleString();
                
                const categoryBadge = item.category 
                    ? `<span style="background: #667eea; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin-left: 10px;">${item.category}</span>`
                    : '';
                
                historyItem.innerHTML = `
                    <div class="history-question">${item.question}${categoryBadge}</div>
                    <div class="history-meta">
                        <span>${dateStr}</span>
                        <span>${item.response_count} responses</span>
                    </div>
                `;
                
                historyItem.addEventListener('click', () => loadQueryDetails(item.id));
                listDiv.appendChild(historyItem);
            });
        }

        async function loadQueryDetails(queryId) {
            try {
                const response = await fetch(`/query/${queryId}`);
                const data = await response.json();
                
                document.getElementById('question-input').value = data.question;
                
                const formattedData = {
                    question: data.question,
                    results: data.responses.map(r => ({
                        success: true,
                        system: r.ai_system,
                        model: r.model,
                        raw_response: r.raw_response,
                        extracted_rating: r.extracted_rating,
                        response_time: r.response_time,
                        word_count: r.word_count,
                        hedge_count: r.hedge_count,
                        hedge_frequency: r.hedge_frequency,
                        sentiment_score: r.sentiment_score,
                        controversy_word_count: r.controversy_word_count
                    }))
                };
                
                displayResults(formattedData);
                document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error loading query details:', error);
                alert('Error loading query details');
            }
        }
    </script>
</body>
</html>

<!-- I did no harm and this file is not truncated -->
