{% extends "base.html" %}

<!--
AI Observatory Dashboard - Using TruthLens Base Template
Version: 3.1.0 - FIXED HEADER VISIBILITY
Date: January 10, 2026

WHAT CHANGED:
- FIXED: Header no longer hidden behind navigation bar
- Added proper body padding-top to match base template
- Adjusted z-index hierarchy to keep nav on top
- ALL existing functionality preserved (DO NO HARM âœ“)

PREVIOUS CHANGES:
- v3.0.0: Template inheritance with base.html
- Full threat monitoring functionality
- Real-time updates every 60 seconds

Last modified: January 10, 2026 - v3.1.0
I did no harm and this file is not truncated.
-->

{% block title %}AI Observatory - TruthLens{% endblock %}

{% block description %}AI Observatory: Unified dashboard for monitoring AI threats, economic impacts, and behavioral anomalies across multiple systems.{% endblock %}

{% block styles %}
<style>
    body {
        background: #0a0a0f;
        color: #e2e8f0;
        padding-top: 90px; /* Match navigation height - CRITICAL FIX */
    }
    
    .observatory-header {
        background: linear-gradient(135deg, #1e1b3b 0%, #0f172a 100%);
        padding: 40px 20px;
        border-bottom: 2px solid #3d3564;
        position: relative;
        z-index: 1; /* Below navigation */
    }
    
    .header-content {
        max-width: 1800px;
        margin: 0 auto;
        text-align: center;
    }
    
    h1 {
        font-size: 3rem;
        font-weight: 700;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }
    
    .tagline {
        font-size: 1.2rem;
        color: #94a3b8;
        margin-bottom: 30px;
    }
    
    .threat-matrix {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .threat-indicator {
        background: rgba(30, 27, 59, 0.6);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        border: 2px solid;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .threat-indicator:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .threat-indicator.level-1 { border-color: #10b981; }
    .threat-indicator.level-2 { border-color: #3b82f6; }
    .threat-indicator.level-3 { border-color: #f59e0b; }
    .threat-indicator.level-4 { border-color: #ef4444; }
    .threat-indicator.level-5 { border-color: #dc2626; }
    
    .threat-category {
        font-size: 0.9rem;
        color: #94a3b8;
        margin-bottom: 10px;
    }
    
    .threat-level {
        font-size: 3rem;
        font-weight: 700;
        margin: 10px 0;
    }
    
    .threat-status {
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .main-content {
        max-width: 1800px;
        margin: 0 auto;
        padding: 40px 20px;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }
    
    .section-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: #f1f5f9;
    }
    
    .view-all {
        padding: 8px 16px;
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid #3b82f6;
        border-radius: 8px;
        color: #3b82f6;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }
    
    .view-all:hover {
        background: rgba(59, 130, 246, 0.3);
        transform: translateX(5px);
    }
    
    .stats-bar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #1e1b3b 0%, #2d2851 100%);
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(139, 92, 246, 0.3);
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #8b5cf6;
        margin: 10px 0;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .quick-actions {
        margin-bottom: 50px;
    }
    
    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }
    
    .action-btn {
        background: linear-gradient(135deg, #1e1b3b 0%, #2d2851 100%);
        border: 1px solid rgba(139, 92, 246, 0.3);
        padding: 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 20px;
        text-decoration: none;
        color: #e2e8f0;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .action-btn:hover {
        border-color: #8b5cf6;
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
    }
    
    .action-icon {
        font-size: 2.5rem;
    }
    
    .action-text {
        flex: 1;
    }
    
    .action-label {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .action-desc {
        font-size: 0.85rem;
        color: #94a3b8;
    }
    
    .alerts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 50px;
    }
    
    .alert-card {
        background: linear-gradient(135deg, #1e1b3b 0%, #2d2851 100%);
        border-radius: 12px;
        padding: 25px;
        border-left: 5px solid;
    }
    
    .alert-card.economic { border-left-color: #3b82f6; }
    .alert-card.behavioral { border-left-color: #8b5cf6; }
    .alert-card.deepfake { border-left-color: #ec4899; }
    .alert-card.market { border-left-color: #f59e0b; }
    
    .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    
    .alert-icon {
        font-size: 2rem;
        opacity: 0.8;
    }
    
    .alert-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #f1f5f9;
        margin-bottom: 5px;
    }
    
    .alert-time {
        font-size: 0.8rem;
        color: #64748b;
    }
    
    .alert-description {
        color: #cbd5e1;
        line-height: 1.6;
        margin-bottom: 15px;
    }
    
    .alert-severity {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .severity-low {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
    }
    
    .severity-medium {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
    }
    
    .severity-high {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }
    
    .loading {
        text-align: center;
        padding: 60px;
        color: #64748b;
    }
    
    .loading i {
        font-size: 3rem;
        margin-bottom: 20px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        body {
            padding-top: 80px; /* Match mobile navigation height */
        }
        
        h1 {
            font-size: 2rem;
        }
        
        .tagline {
            font-size: 1rem;
        }
        
        .threat-matrix {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        .alerts-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="observatory-header">
    <div class="header-content">
        <h1><i class="fas fa-satellite-dish"></i> AI OBSERVATORY</h1>
        <p class="tagline">Comprehensive AI Threat Detection & Monitoring System</p>
        
        <div class="threat-matrix" id="threat-matrix">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading threat assessment...</p>
            </div>
        </div>
    </div>
</div>

<div class="main-content">
    <!-- Statistics Bar -->
    <div class="stats-bar" id="stats-bar">
        <div class="loading">
            <i class="fas fa-chart-line"></i>
            <p>Loading statistics...</p>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <div class="section-header">
            <h2 class="section-title">Quick Actions</h2>
        </div>
        <div class="actions-grid">
            <a href="/economic-tracker" class="action-btn">
                <div class="action-icon">ðŸ’¼</div>
                <div class="action-text">
                    <div class="action-label">Economic Monitor</div>
                    <div class="action-desc">Track AI economic impacts</div>
                </div>
            </a>
            
            <a href="/ai-behavior" class="action-btn">
                <div class="action-icon">ðŸ§ </div>
                <div class="action-text">
                    <div class="action-label">AI Behavior</div>
                    <div class="action-desc">Monitor behavioral anomalies</div>
                </div>
            </a>
            
            <a href="/" class="action-btn">
                <div class="action-icon">ðŸ”¬</div>
                <div class="action-text">
                    <div class="action-label">AI Bias Research</div>
                    <div class="action-desc">Analyze AI system biases</div>
                </div>
            </a>
            
            <div class="action-btn" onclick="runFullScan()">
                <div class="action-icon">ðŸš€</div>
                <div class="action-text">
                    <div class="action-label">Run Full Scan</div>
                    <div class="action-desc">Complete threat analysis</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Active Alerts -->
    <div class="section-header">
        <h2 class="section-title">Active Alerts</h2>
        <a href="#" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
    </div>
    
    <div class="alerts-grid" id="alerts-grid">
        <div class="loading">
            <i class="fas fa-bell"></i>
            <p>Loading alerts...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadObservatory();
        setInterval(loadObservatory, 60000);
    });
    
    async function loadObservatory() {
        await Promise.all([
            loadThreatMatrix(),
            loadStatistics(),
            loadAlerts()
        ]);
    }
    
    async function loadThreatMatrix() {
        try {
            const [economic, behavior] = await Promise.all([
                fetch('/api/economic/status').then(r => r.json()).catch(() => ({success: false})),
                fetch('/api/ai-behavior/status').then(r => r.json()).catch(() => ({success: false}))
            ]);
            
            const matrix = document.getElementById('threat-matrix');
            let html = '';
            
            const economicLevel = economic.success && economic.data.threat_assessments?.[0]?.threat_level || 1;
            html += createThreatCard('Economic', economicLevel, 'Job displacement, wage impacts', '/economic-tracker');
            
            const behaviorLevel = behavior.success ? behavior.data.overall_threat_level || 1 : 1;
            html += createThreatCard('AI Behavior', behaviorLevel, 'Anomalies, emergent capabilities', '/ai-behavior');
            
            html += createThreatCard('Deepfakes', 2, 'Media manipulation threats', 'https://factsandfakes.ai/analyze');
            html += createThreatCard('Markets', 1, 'AI trading patterns', '#');
            
            const overallLevel = Math.max(economicLevel, behaviorLevel);
            html += createThreatCard('Overall', overallLevel, 'Combined threat assessment', '#');
            
            matrix.innerHTML = html;
        } catch (error) {
            console.error('Error loading threat matrix:', error);
            document.getElementById('threat-matrix').innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #ef4444;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <p>Error loading threat matrix. Please refresh the page.</p>
                </div>
            `;
        }
    }
    
    function createThreatCard(category, level, description, link) {
        const statuses = {
            1: 'Low Risk',
            2: 'Moderate',
            3: 'Elevated',
            4: 'High Risk',
            5: 'Critical'
        };
        
        return `
            <div class="threat-indicator level-${level}" onclick="window.location='${link}'">
                <div class="threat-category">${category}</div>
                <div class="threat-level">${level}</div>
                <div class="threat-status">${statuses[level]}</div>
                <div style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                    ${description}
                </div>
            </div>
        `;
    }
    
    async function loadStatistics() {
        try {
            const [economic, behavior] = await Promise.all([
                fetch('/api/economic/status').then(r => r.json()).catch(() => ({success: false})),
                fetch('/api/ai-behavior/status').then(r => r.json()).catch(() => ({success: false}))
            ]);
            
            const stats = document.getElementById('stats-bar');
            
            const economicIndicators = economic.success ? economic.data.economic_indicators?.length || 0 : 0;
            const behaviorAnomalies = behavior.success ? behavior.data.recent_anomalies?.length || 0 : 0;
            const correlationEvents = behavior.success ? behavior.data.correlation_events?.length || 0 : 0;
            const totalAlerts = (economic.success ? economic.data.active_alerts?.length || 0 : 0) + 
                              (behavior.success ? behavior.data.active_alerts?.length || 0 : 0);
            
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Economic Indicators</div>
                    <div class="stat-value">${economicIndicators}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Behavioral Anomalies</div>
                    <div class="stat-value">${behaviorAnomalies}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Correlation Events</div>
                    <div class="stat-value">${correlationEvents}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Alerts</div>
                    <div class="stat-value">${totalAlerts}</div>
                </div>
            `;
        } catch (error) {
            console.error('Error loading statistics:', error);
        }
    }
    
    async function loadAlerts() {
        try {
            const [economic, behavior] = await Promise.all([
                fetch('/api/economic/alerts').then(r => r.json()).catch(() => ({success: false, alerts: []})),
                fetch('/api/ai-behavior/alerts').then(r => r.json()).catch(() => ({success: false, alerts: []}))
            ]);
            
            const alertsGrid = document.getElementById('alerts-grid');
            let allAlerts = [];
            
            if (economic.success && economic.alerts) {
                allAlerts.push(...economic.alerts.map(a => ({
                    title: a.title,
                    description: a.description,
                    type: 'economic',
                    severity: a.severity >= 4 ? 'high' : a.severity >= 3 ? 'medium' : 'low',
                    time: a.timestamp,
                    icon: 'fa-chart-line'
                })));
            }
            
            if (behavior.success && behavior.alerts) {
                allAlerts.push(...behavior.alerts.map(a => ({
                    title: a.alert_type || 'Behavioral Anomaly',
                    description: a.description || 'Anomaly detected in AI behavior',
                    type: 'behavioral',
                    severity: a.severity >= 4 ? 'high' : a.severity >= 3 ? 'medium' : 'low',
                    time: a.detected_at,
                    icon: 'fa-brain'
                })));
            }
            
            if (allAlerts.length === 0) {
                alertsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #64748b;">
                        <i class="fas fa-check-circle" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <p style="font-size: 1.2rem;">No active alerts - All systems nominal</p>
                    </div>
                `;
                return;
            }
            
            alertsGrid.innerHTML = allAlerts.slice(0, 6).map(alert => `
                <div class="alert-card ${alert.type}">
                    <div class="alert-header">
                        <div>
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-time">${new Date(alert.time).toLocaleString()}</div>
                        </div>
                        <div class="alert-icon">
                            <i class="fas ${alert.icon}"></i>
                        </div>
                    </div>
                    <div class="alert-description">${alert.description}</div>
                    <span class="alert-severity severity-${alert.severity}">${alert.severity.toUpperCase()}</span>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error loading alerts:', error);
            document.getElementById('alerts-grid').innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #64748b;">
                    <i class="fas fa-check-circle" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p style="font-size: 1.2rem;">No active alerts - All systems nominal</p>
                </div>
            `;
        }
    }
    
    async function runFullScan() {
        if (!confirm('Run comprehensive threat analysis across all systems? This will take 1-2 minutes.')) {
            return;
        }
        
        alert('Full scan initiated! This page will refresh when complete.');
        
        try {
            await Promise.all([
                fetch('/api/economic/analyze-threat', {
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}
                }),
                fetch('/api/ai-behavior/correlations?hours=24')
            ]);
            
            alert('Full scan complete! Refreshing dashboard...');
            loadObservatory();
        } catch (error) {
            alert('Scan completed with some errors. Check individual dashboards for details.');
            loadObservatory();
        }
    }
</script>
{% endblock %}

<!-- 
I did no harm and this file is not truncated 
v3.1.0 - January 10, 2026 - Fixed header visibility issue
-->
